# Test run 12 - Tue Aug 19 18:57:16 UTC 2025
# Command: pytest tests/test_api_routes.py -v

============================= test session starts ==============================
platform linux -- Python 3.10.12, pytest-8.4.1, pluggy-1.6.0 -- /home/dcapps/projects/ldap-admin/venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/dcapps/projects/ldap-admin
plugins: cov-6.2.1, mock-3.14.1, flask-1.3.0
collecting ... collected 6 items

tests/test_api_routes.py::TestApiRoutes::test_api_users_get FAILED       [ 16%]
tests/test_api_routes.py::TestApiRoutes::test_api_users_post FAILED      [ 33%]
tests/test_api_routes.py::TestApiRoutes::test_api_users_delete FAILED    [ 50%]
tests/test_api_routes.py::TestApiRoutes::test_api_groups_get FAILED      [ 66%]
tests/test_api_routes.py::TestApiRoutes::test_api_stats FAILED           [ 83%]
tests/test_api_routes.py::TestApiRoutes::test_api_test_connection FAILED [100%]

=================================== FAILURES ===================================
_______________________ TestApiRoutes.test_api_users_get _______________________

self = <tests.test_api_routes.TestApiRoutes object at 0x7f92244bb1f0>
client = <FlaskClient <Flask 'app'>>
mock_ldap_connection = <Mock name='Connection()' id='140265628786384'>

    def test_api_users_get(self, client, mock_ldap_connection):
        """Test GET /api/users endpoint."""
        # Mock user data
        mock_user = Mock()
        mock_user.cn.value = 'testuser'
        mock_user.mail.value = 'test@example.com'
        mock_user.givenName.value = 'Test'
        mock_user.sn.value = 'User'
        mock_ldap_connection.entries = [mock_user]
    
        with patch('app.get_ldap_connection', return_value=mock_ldap_connection):
            response = client.get('/api/users')
>           assert response.status_code in [200, 401, 403]
E           assert 302 in [200, 401, 403]
E            +  where 302 = <WrapperTestResponse streamed [302 FOUND]>.status_code

tests/test_api_routes.py:20: AssertionError
______________________ TestApiRoutes.test_api_users_post _______________________

self = <tests.test_api_routes.TestApiRoutes object at 0x7f92244bad40>
client = <FlaskClient <Flask 'app'>>
mock_ldap_connection = <Mock name='Connection()' id='140265629161296'>

    def test_api_users_post(self, client, mock_ldap_connection):
        """Test POST /api/users endpoint."""
        user_data = {
            'username': 'newuser',
            'email': 'newuser@example.com',
            'first_name': 'New',
            'last_name': 'User',
            'password': 'SecurePass123!'
        }
    
        with patch('app.get_ldap_connection', return_value=mock_ldap_connection):
            response = client.post('/api/users',
                                  data=json.dumps(user_data),
                                  content_type='application/json')
>           assert response.status_code in [201, 400, 401, 403, 409]
E           assert 302 in [201, 400, 401, 403, 409]
E            +  where 302 = <WrapperTestResponse streamed [302 FOUND]>.status_code

tests/test_api_routes.py:41: AssertionError
_____________________ TestApiRoutes.test_api_users_delete ______________________

self = <tests.test_api_routes.TestApiRoutes object at 0x7f92244babc0>
client = <FlaskClient <Flask 'app'>>
mock_ldap_connection = <Mock name='Connection()' id='140265628913040'>

    def test_api_users_delete(self, client, mock_ldap_connection):
        """Test DELETE /api/users/<username> endpoint."""
        with patch('app.get_ldap_connection', return_value=mock_ldap_connection):
            response = client.delete('/api/users/testuser')
>           assert response.status_code in [200, 401, 403, 404]
E           assert 302 in [200, 401, 403, 404]
E            +  where 302 = <WrapperTestResponse streamed [302 FOUND]>.status_code

tests/test_api_routes.py:47: AssertionError
______________________ TestApiRoutes.test_api_groups_get _______________________

self = <tests.test_api_routes.TestApiRoutes object at 0x7f92244bb280>
client = <FlaskClient <Flask 'app'>>
mock_ldap_connection = <Mock name='Connection()' id='140265628787392'>

    def test_api_groups_get(self, client, mock_ldap_connection):
        """Test GET /api/groups endpoint."""
        # Mock group data
        mock_group = Mock()
        mock_group.cn.value = 'testgroup'
        mock_group.description.value = 'Test Group'
        mock_ldap_connection.entries = [mock_group]
    
        with patch('app.get_ldap_connection', return_value=mock_ldap_connection):
            response = client.get('/api/groups')
>           assert response.status_code in [200, 401, 403]
E           assert 302 in [200, 401, 403]
E            +  where 302 = <WrapperTestResponse streamed [302 FOUND]>.status_code

tests/test_api_routes.py:59: AssertionError
_________________________ TestApiRoutes.test_api_stats _________________________

self = <tests.test_api_routes.TestApiRoutes object at 0x7f92244bb040>
client = <FlaskClient <Flask 'app'>>
mock_ldap_connection = <Mock name='Connection()' id='140265629555424'>

    def test_api_stats(self, client, mock_ldap_connection):
        """Test GET /api/stats endpoint."""
        with patch('app.get_ldap_connection', return_value=mock_ldap_connection):
            response = client.get('/api/stats')
>           assert response.status_code in [200, 401, 403]
E           assert 302 in [200, 401, 403]
E            +  where 302 = <WrapperTestResponse streamed [302 FOUND]>.status_code

tests/test_api_routes.py:70: AssertionError
____________________ TestApiRoutes.test_api_test_connection ____________________

self = <tests.test_api_routes.TestApiRoutes object at 0x7f92244bba00>
client = <FlaskClient <Flask 'app'>>
mock_ldap_connection = <Mock name='Connection()' id='140265629693600'>

    def test_api_test_connection(self, client, mock_ldap_connection):
        """Test GET /api/test_connection endpoint."""
        with patch('app.get_ldap_connection', return_value=mock_ldap_connection):
            response = client.get('/api/test_connection')
>           assert response.status_code in [200, 401, 403]
E           assert 404 in [200, 401, 403]
E            +  where 404 = <WrapperTestResponse streamed [404 NOT FOUND]>.status_code

tests/test_api_routes.py:81: AssertionError
=============================== warnings summary ===============================
tests/test_api_routes.py::TestApiRoutes::test_api_users_get
tests/test_api_routes.py::TestApiRoutes::test_api_users_get
  /home/dcapps/projects/ldap-admin/venv/lib/python3.10/site-packages/flask_wtf/recaptcha/widgets.py:2: DeprecationWarning: 'flask.Markup' is deprecated and will be removed in Flask 2.4. Import 'markupsafe.Markup' instead.
    from flask import Markup

tests/test_api_routes.py::TestApiRoutes::test_api_users_get
  /home/dcapps/projects/ldap-admin/venv/lib/python3.10/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
    warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)

tests/test_api_routes.py::TestApiRoutes::test_api_users_get
  /home/dcapps/projects/ldap-admin/venv/lib/python3.10/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
    warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)

tests/test_api_routes.py::TestApiRoutes::test_api_users_get
  /home/dcapps/projects/ldap-admin/venv/lib/python3.10/site-packages/flask_limiter/extension.py:336: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_api_routes.py::TestApiRoutes::test_api_users_get - assert 3...
FAILED tests/test_api_routes.py::TestApiRoutes::test_api_users_post - assert ...
FAILED tests/test_api_routes.py::TestApiRoutes::test_api_users_delete - asser...
FAILED tests/test_api_routes.py::TestApiRoutes::test_api_groups_get - assert ...
FAILED tests/test_api_routes.py::TestApiRoutes::test_api_stats - assert 302 i...
FAILED tests/test_api_routes.py::TestApiRoutes::test_api_test_connection - as...
======================== 6 failed, 5 warnings in 1.10s =========================

# End of test run 12 - Tue Aug 19 18:57:18 UTC 2025
